const { SecretManagerServiceClient } = require("@google-cloud/secret-manager");
const client = new SecretManagerServiceClient({});

export const SECRETS_CONF = {
  CRM: "projects/977231058321/secrets/CRM_KEY/versions/3",
};

export async function getSecret(name: string) {
  const [accessResponse] = await client.accessSecretVersion({name});
  const _headers = accessResponse.payload.data.toString("utf8")
  const headers = parseCustom(_headers)
  return {headers}
}

function parseCustom(_headers: string) {
  const arr = _headers.split(',')
  const output = arr.reduce((acc, curr) => {
    const chunk = curr.split(':')
    if (chunk[1].includes('QB-USER-TOKEN')) {
      const temp = chunk[1].split('N')
      chunk[1] = temp.join('N ')
    }
    acc[chunk[0]] = chunk[1];
    return acc
  }, {})
  return output

}
{

}
